{

    const VOTES_JSON=
[
{
"questionId": "Q1",
"Vote": 5,
"userId": "U1"
},
{
"questionId": "Q1",
"Vote": 5,
"userId": "U2"
},
{
"questionId": "Q1",
"Vote": 2,
"userId": "U3"
},
{
"questionId": "Q1",
"Vote": 3,
"userId": "U4"
},
{
"questionId": "Q1",
"Vote": 2,
"userId": "U5"
},
{
"questionId": "Q1",
"Vote": 3,
"userId": "U6"
},
{
"questionId": "Q1",
"Vote": 1,
"userId": "U7"
},
{
"questionId": "Q1",
"Vote": 4,
"userId": "U8"
},
{
"questionId": "Q1",
"Vote": 3,
"userId": "U9"
},
{
"questionId": "Q1",
"Vote": 5,
"userId": "U10"
},
{
"questionId": "Q1",
"Vote": 4,
"userId": "U11"
},
{
"questionId": "Q1",
"Vote": 1,
"userId": "U12"
},
{
"questionId": "Q1",
"Vote": 4,
"userId": "U13"
},
{
"questionId": "Q1",
"Vote": 5,
"userId": "U14"
},
{
"questionId": "Q1",
"Vote": 5,
"userId": "U15"
},
{
"questionId": "Q1",
"Vote": 3,
"userId": "U16"
},
{
"questionId": "Q1",
"Vote": 4,
"userId": "U17"
},
{
"questionId": "Q1",
"Vote": 3,
"userId": "U18"
},
{
"questionId": "Q1",
"Vote": 2,
"userId": "U19"
},
{
"questionId": "Q1",
"Vote": 2,
"userId": "U20"
},
{
"questionId": "Q2",
"Vote": 5,
"userId": "U1"
},
{
"questionId": "Q2",
"Vote": 2,
"userId": "U2"
},
{
"questionId": "Q2",
"Vote": 5,
"userId": "U3"
},
{
"questionId": "Q2",
"Vote": 2,
"userId": "U4"
},
{
"questionId": "Q2",
"Vote": 4,
"userId": "U5"
},
{
"questionId": "Q2",
"Vote": 4,
"userId": "U6"
},
{
"questionId": "Q2",
"Vote": 2,
"userId": "U7"
},
{
"questionId": "Q2",
"Vote": 2,
"userId": "U8"
},
{
"questionId": "Q2",
"Vote": 5,
"userId": "U9"
},
{
"questionId": "Q2",
"Vote": 1,
"userId": "U10"
},
{
"questionId": "Q2",
"Vote": 3,
"userId": "U11"
},
{
"questionId": "Q2",
"Vote": 4,
"userId": "U12"
},
{
"questionId": "Q2",
"Vote": 3,
"userId": "U13"
},
{
"questionId": "Q2",
"Vote": 4,
"userId": "U14"
},
{
"questionId": "Q2",
"Vote": 5,
"userId": "U15"
},
{
"questionId": "Q2",
"Vote": 1,
"userId": "U16"
},
{
"questionId": "Q2",
"Vote": 5,
"userId": "U17"
},
{
"questionId": "Q2",
"Vote": 5,
"userId": "U18"
},
{
"questionId": "Q2",
"Vote": 3,
"userId": "U19"
},
{
"questionId": "Q2",
"Vote": 4,
"userId": "U20"
},
{
"questionId": "Q3",
"Vote": 1,
"userId": "U1"
},
{
"questionId": "Q3",
"Vote": 4,
"userId": "U2"
},
{
"questionId": "Q3",
"Vote": 5,
"userId": "U3"
},
{
"questionId": "Q3",
"Vote": 2,
"userId": "U4"
},
{
"questionId": "Q3",
"Vote": 2,
"userId": "U5"
},
{
"questionId": "Q3",
"Vote": 3,
"userId": "U6"
},
{
"questionId": "Q3",
"Vote": 5,
"userId": "U7"
},
{
"questionId": "Q3",
"Vote": 1,
"userId": "U8"
},
{
"questionId": "Q3",
"Vote": 2,
"userId": "U9"
},
{
"questionId": "Q3",
"Vote": 1,
"userId": "U10"
},
{
"questionId": "Q3",
"Vote": 1,
"userId": "U11"
},
{
"questionId": "Q3",
"Vote": 2,
"userId": "U12"
},
{
"questionId": "Q3",
"Vote": 4,
"userId": "U13"
},
{
"questionId": "Q3",
"Vote": 4,
"userId": "U14"
},
{
"questionId": "Q3",
"Vote": 5,
"userId": "U15"
},
{
"questionId": "Q3",
"Vote": 2,
"userId": "U16"
},
{
"questionId": "Q3",
"Vote": 5,
"userId": "U17"
},
{
"questionId": "Q3",
"Vote": 1,
"userId": "U18"
},
{
"questionId": "Q3",
"Vote": 3,
"userId": "U19"
},
{
"questionId": "Q3",
"Vote": 1,
"userId": "U20"
}
]
const USER_JSON=
[
{
"User": "U1",
"location": "Bangalore",
"designation": "Manager",
"department": "Engg"
},
{
"User": "U2",
"location": "Sydney",
"designation": "Manager",
"department": "HR"
},
{
"User": "U3",
"location": "London",
"designation": "Manager",
"department": "Admin"
},
{
"User": "U4",
"location": "SF",
"designation": "Manager",
"department": "Ops"
},
{
"User": "U5",
"location": "Mumbai",
"designation": "Manager",
"department": "Engg"
},
{
"User": "U6",
"location": "Bangalore",
"designation": "Developer",
"department": "Engg"
},
{
"User": "U7",
"location": "Sydney",
"designation": "Manager",
"department": "HR"
},
{
"User": "U8",
"location": "London",
"designation": "Manager",
"department": "Admin"
},
{
"User": "U9",
"location": "Bangalore",
"designation": "Manager",
"department": "Ops"
},
{
"User": "U10",
"location": "Sydney",
"designation": "Developer",
"department": "Engg"
},
{
"User": "U11",
"location": "Bangalore",
"designation": "Manager",
"department": "HR"
},
{
"User": "U12",
"location": "SF",
"designation": "Manager",
"department": "Admin"
},
{
"User": "U13",
"location": "Mumbai",
"designation": "Manager",
"department": "Engg"
},
{
"User": "U14",
"location": "Sydney",
"designation": "Manager",
"department": "HR"
},
{
"User": "U15",
"location": "Bangalore",
"designation": "Manager",
"department": "Admin"
},
{
"User": "U16",
"location": "Sydney",
"designation": "CEO",
"department": "Engg"
},
{
"User": "U17",
"location": "London",
"designation": "Manager",
"department": "HR"
},
{
"User": "U18",
"location": "SF",
"designation": "Manager",
"department": "Admin"
},
{
"User": "U19",
"location": "Mumbai",
"designation": "Manager",
"department": "Ops"
},
{
"User": "U20",
"location": "Mumbai",
"designation": "Manager",
"department": "Engg"
}
]

const sentiment_calculation=(dimension)=>{
    let dimensions_set= [];
    USER_JSON.map((user)=>{
         //   dimension_set.add(user[`${dimension}`]);
         if(dimensions_set.length>0){
            let dimensionExist = dimensions_set.filter(ele=>ele.dimension===user[`${dimension}`])[0];
            if(dimensionExist){
              dimensionExist['usersList']= [...dimensionExist['usersList'],user];
            }else{

             dimensions_set.push({'dimension':user[`${dimension}`],'usersList':[user]});
            }
         }else{
             const arr=[];
             arr.push(user);
             dimensions_set.push({'dimension':user[`${dimension}`],'usersList':[user]});
         }
        
    });

   let outputStats=dimensions_set.map(()=>0);
   let neutralVotes = dimensions_set.map(()=>0);
   VOTES_JSON.map((votes)=>{

       dimensions_set.map((eachDimension,index)=>{
        if(eachDimension.usersList.filter(ele=>ele.User===votes.userId)[0]){
            if(votes.Vote===5 || votes.Vote===4){
                outputStats[index]+=1;
            }else if(votes.Vote===2 || votes.Vote===1)
            outputStats[index]-=1;
            else{
                neutralVotes[index]+=1;
            }
        }
  });

   });

  const outputJson=[];
  dimensions_set.map((eachDimension,index)=>{
      const peopleVoted = eachDimension.usersList.length-neutralVotes[index]>=0?eachDimension.usersList.length-neutralVotes[index]:0;
      const peopleCountInDimension = eachDimension.usersList.length;
      let calc = ((peopleVoted)/
      peopleCountInDimension)*100;
      calc= Math.round(calc*100)/100;

      outputJson.push({'segment':eachDimension.dimension,'sentimentScore':outputStats[index],'participationPercentage':calc,
      'neutralVotes':neutralVotes[index],peopleVoted,peopleCountInDimension});
     // console.log("Segment:\n"+eachDimension.dimension+"\nSentiment Score:\n"+outputStats[index]+
     //  "\nParticipation Percentage:\n"+calc);
      });

const overallSentiment =outputStats.reduce(function(a, b){
        return a + b;
    }, 0);
outputJson.push({overallSentiment});
   return outputJson;
}

let outputJson=sentiment_calculation('location');
console.log(outputJson);

outputJson=sentiment_calculation('department');
console.log(outputJson);

outputJson=sentiment_calculation('designation');
console.log(outputJson);

}